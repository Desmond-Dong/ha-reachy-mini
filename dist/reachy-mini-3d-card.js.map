{"version":3,"file":"reachy-mini-3d-card.js","sources":["../src/reachy-mini-3d-card-v2.js"],"sourcesContent":["// Reachy Mini 3D Card for Home Assistant\r\n// Áõ¥Êé•ËøûÊé•ÁâàÊú¨ - Êó†ÈúÄ ESPHome,Áõ¥Êé•ËøûÊé• Reachy Mini Daemon\r\n// ÂèÇËÄÉ reachy-mini-desktop-app ÁöÑ WebSocket ËøûÊé•ÊñπÂºè\r\n\r\n// Á´ãÂç≥Ê≥®ÂÜå customCards\r\nwindow.customCards = window.customCards || [];\r\nwindow.customCards.push({\r\n  type: 'reachy-mini-3d-card',\r\n  name: 'Reachy Mini 3D Card',\r\n  description: 'Real-time 3D visualization of Reachy Mini robot with direct daemon connection',\r\n  preview: true,\r\n  documentationURL: 'https://github.com/Desmond-Dong/ha-reachy-mini-card'\r\n});\r\n\r\n(async () => {\r\n  try {\r\n    // Âä†ËΩΩ Three.js Âíå‰æùËµñ\r\n    const loadScript = (url) => new Promise((resolve, reject) => {\r\n      const script = document.createElement('script');\r\n      script.src = url;\r\n      script.onload = resolve;\r\n      script.onerror = reject;\r\n      document.head.appendChild(script);\r\n    });\r\n\r\n    if (!window.THREE) {\r\n      await loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js');\r\n    }\r\n    await loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js');\r\n    await loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/STLLoader.js');\r\n\r\n    // LitElement\r\n    let LitElement, html, css;\r\n    if (window.LitElement) {\r\n      LitElement = window.LitElement;\r\n      html = window.html;\r\n      css = window.css;\r\n    } else {\r\n      await loadScript('https://cdn.jsdelivr.net/npm/@lit/reactive-element@1.6.0/reactive-element.js');\r\n      await loadScript('https://cdn.jsdelivr.net/npm/lit@3.1.0/lit-element.js');\r\n      LitElement = window.LitElement || window.LitElementElement;\r\n      html = window.html || ((strings, ...values) => ({ strings, values }));\r\n      css = window.css || ((strings, ...values) => strings.join(''));\r\n    }\r\n\r\n    class ReachyMini3DCard extends LitElement {\r\n      static get properties() {\r\n        return {\r\n          hass: Object,\r\n          config: Object,\r\n          _editing: { type: Boolean, state: true },\r\n          _loaded: { type: Boolean, state: true },\r\n          _connectionStatus: { type: String, state: true },\r\n          _robotData: { type: Object, state: true }\r\n        };\r\n      }\r\n\r\n      static get styles() {\r\n        return css`\r\n          :host {\r\n            display: block;\r\n            width: 100%;\r\n            position: relative;\r\n          }\r\n          ha-card {\r\n            overflow: hidden;\r\n            border-radius: var(--ha-card-border-radius, 12px);\r\n            box-shadow: var(--ha-card-box-shadow, none);\r\n          }\r\n          .card-container {\r\n            width: 100%;\r\n            position: relative;\r\n          }\r\n          #canvas-container {\r\n            width: 100%;\r\n            height: 400px;\r\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n            position: relative;\r\n          }\r\n          .status-overlay {\r\n            position: absolute;\r\n            top: 10px;\r\n            left: 10px;\r\n            background: rgba(0,0,0,0.6);\r\n            color: white;\r\n            padding: 8px 12px;\r\n            border-radius: 8px;\r\n            font-family: var(--font-family, Roboto);\r\n            font-size: 12px;\r\n            pointer-events: none;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n          }\r\n          .status-indicator {\r\n            width: 8px;\r\n            height: 8px;\r\n            border-radius: 50%;\r\n            background: #4caf50;\r\n          }\r\n          .status-indicator.connecting {\r\n            background: #ff9800;\r\n            animation: pulse 1s infinite;\r\n          }\r\n          .status-indicator.error {\r\n            background: #f44336;\r\n          }\r\n          @keyframes pulse {\r\n            0%, 100% { opacity: 1; }\r\n            50% { opacity: 0.5; }\r\n          }\r\n          .controls {\r\n            position: absolute;\r\n            bottom: 10px;\r\n            right: 10px;\r\n            display: flex;\r\n            gap: 8px;\r\n          }\r\n          .control-btn {\r\n            background: rgba(255,255,255,0.9);\r\n            border: none;\r\n            border-radius: 8px;\r\n            padding: 8px 12px;\r\n            cursor: pointer;\r\n            font-size: 20px;\r\n            transition: all 0.2s;\r\n            box-shadow: 0 2px 8px rgba(0,0,0,0.2);\r\n          }\r\n          .control-btn:hover {\r\n            background: white;\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\r\n          }\r\n          .edit-mode {\r\n            position: absolute;\r\n            top: 10px;\r\n            right: 10px;\r\n            z-index: 100;\r\n          }\r\n          .edit-btn {\r\n            background: var(--primary-color, #03a9f4);\r\n            color: white;\r\n            border: none;\r\n            border-radius: 50%;\r\n            width: 40px;\r\n            height: 40px;\r\n            cursor: pointer;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            font-size: 20px;\r\n            box-shadow: 0 2px 8px rgba(0,0,0,0.3);\r\n            transition: all 0.2s;\r\n          }\r\n          .edit-btn:hover {\r\n            background: var(--primary-color, #0288d1);\r\n            transform: scale(1.1);\r\n          }\r\n          .config-panel {\r\n            position: absolute;\r\n            top: 0;\r\n            right: 0;\r\n            width: 320px;\r\n            height: 100%;\r\n            background: white;\r\n            box-shadow: -4px 0 16px rgba(0,0,0,0.1);\r\n            border-radius: 12px 0 0 12px;\r\n            padding: 20px;\r\n            overflow-y: auto;\r\n            z-index: 1000;\r\n            transform: translateX(100%);\r\n            transition: transform 0.3s ease;\r\n          }\r\n          .config-panel.open {\r\n            transform: translateX(0);\r\n          }\r\n          .config-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 20px;\r\n            padding-bottom: 10px;\r\n            border-bottom: 2px solid #f0f0f0;\r\n          }\r\n          .config-header h3 {\r\n            margin: 0;\r\n            color: #333;\r\n            font-size: 18px;\r\n          }\r\n          .close-btn {\r\n            background: none;\r\n            border: none;\r\n            font-size: 24px;\r\n            cursor: pointer;\r\n            color: #666;\r\n            padding: 0;\r\n            width: 30px;\r\n            height: 30px;\r\n          }\r\n          .close-btn:hover {\r\n            color: #333;\r\n          }\r\n          .config-item {\r\n            margin-bottom: 16px;\r\n          }\r\n          .config-item label {\r\n            display: block;\r\n            margin-bottom: 6px;\r\n            font-size: 13px;\r\n            color: #555;\r\n            font-weight: 500;\r\n          }\r\n          .config-item input[type=\"text\"],\r\n          .config-item input[type=\"number\"] {\r\n            width: 100%;\r\n            padding: 8px 12px;\r\n            border: 1px solid #ddd;\r\n            border-radius: 6px;\r\n            font-size: 14px;\r\n            box-sizing: border-box;\r\n            transition: border-color 0.2s;\r\n          }\r\n          .config-item input:focus {\r\n            outline: none;\r\n            border-color: var(--primary-color, #03a9f4);\r\n            box-shadow: 0 0 0 3px rgba(3, 169, 244, 0.1);\r\n          }\r\n          .loading-overlay {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(255,255,255,0.9);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            font-size: 16px;\r\n            color: #666;\r\n            z-index: 50;\r\n          }\r\n          .error-message {\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 50%;\r\n            transform: translate(-50%, -50%);\r\n            text-align: center;\r\n            color: #f44336;\r\n            padding: 20px;\r\n            background: white;\r\n            border-radius: 8px;\r\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n          }\r\n        `;\r\n      }\r\n\r\n      static getStubConfig() {\r\n        return {\r\n          daemon_host: 'localhost',\r\n          daemon_port: 3333,\r\n          height: 400,\r\n          show_controls: true,\r\n          auto_rotate: false\r\n        };\r\n      }\r\n\r\n      setConfig(config) {\r\n        if (!config.daemon_host && !config.daemon_port) {\r\n          // ÂÖºÂÆπÊóßÁâàÊú¨ÈÖçÁΩÆ\r\n          if (config.entity_prefix) {\r\n            console.warn('entity_prefix is deprecated. Please use daemon_host and daemon_port instead.');\r\n          }\r\n        }\r\n        this.config = {\r\n          ...ReachyMini3DCard.getStubConfig(),\r\n          ...config\r\n        };\r\n      }\r\n\r\n      getCardSize() {\r\n        return Math.ceil(this.config.height / 50);\r\n      }\r\n\r\n      constructor() {\r\n        super();\r\n        this._loaded = false;\r\n        this._editing = false;\r\n        this._connectionStatus = 'disconnected';\r\n        this._robotData = {\r\n          headJoints: null,\r\n          headPose: null,\r\n          antennas: [0, 0],\r\n          passiveJoints: null\r\n        };\r\n        this.ws = null;\r\n        this.reconnectAttempts = 0;\r\n        this.maxReconnectAttempts = 3;\r\n      }\r\n\r\n      connectedCallback() {\r\n        super.connectedCallback();\r\n        requestAnimationFrame(() => {\r\n          this.initThreeJS().catch(err => {\r\n            console.error('Failed to initialize Three.js:', err);\r\n            this._loaded = true;\r\n          });\r\n        });\r\n      }\r\n\r\n      disconnectedCallback() {\r\n        super.disconnectedCallback();\r\n        this.cleanup();\r\n      }\r\n\r\n      async initThreeJS() {\r\n        const container = this.shadowRoot?.getElementById('canvas-container');\r\n        if (!container) {\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n          return this.initThreeJS();\r\n        }\r\n\r\n        try {\r\n          // Âú∫ÊôØ\r\n          this.scene = new THREE.Scene();\r\n          this.scene.background = new THREE.Color(0xf0f0f0);\r\n\r\n          // Áõ∏Êú∫\r\n          const width = container.clientWidth;\r\n          const height = this.config?.height || 400;\r\n          this.camera = new THREE.PerspectiveCamera(50, width / height, 0.01, 1000);\r\n          this.camera.position.set(0.3, 0.3, 0.5);\r\n\r\n          // Ê∏≤ÊüìÂô®\r\n          this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\r\n          this.renderer.setSize(width, height);\r\n          this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\r\n          this.renderer.shadowMap.enabled = true;\r\n          this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n          container.appendChild(this.renderer.domElement);\r\n\r\n          // ÊéßÂà∂Âô®\r\n          this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);\r\n          this.controls.enableDamping = true;\r\n          this.controls.dampingFactor = 0.05;\r\n          this.controls.minDistance = 0.2;\r\n          this.controls.maxDistance = 1;\r\n\r\n          // ÁÅØÂÖâ\r\n          const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);\r\n          this.scene.add(ambientLight);\r\n\r\n          const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\r\n          directionalLight.position.set(1, 1, 1);\r\n          directionalLight.castShadow = true;\r\n          this.scene.add(directionalLight);\r\n\r\n          // Âú∞Èù¢ÁΩëÊ†º\r\n          const gridHelper = new THREE.GridHelper(0.4, 20, 0x888888, 0xcccccc);\r\n          this.scene.add(gridHelper);\r\n\r\n          // Âä†ËΩΩÊú∫Âô®‰∫∫Ê®°Âûã\r\n          await this.loadRobotModel();\r\n\r\n          // Ê†áËÆ∞‰∏∫Â∑≤Âä†ËΩΩ\r\n          this._loaded = true;\r\n\r\n          // ËøûÊé• WebSocket\r\n          this.connectWebSocket();\r\n\r\n          // ÂºÄÂßãÂä®ÁîªÂæ™ÁéØ\r\n          this.animate();\r\n\r\n          // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ\r\n          window.addEventListener('resize', this.onWindowResize.bind(this));\r\n        } catch (error) {\r\n          console.error('Error initializing Three.js:', error);\r\n          this._loaded = true;\r\n          this._connectionStatus = 'error';\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      async loadRobotModel() {\r\n        try {\r\n          // Âä®ÊÄÅËé∑ÂèñÂç°ÁâáÂü∫Á°ÄË∑ØÂæÑ\r\n          const getCardBasePath = () => {\r\n            const scripts = document.getElementsByTagName('script');\r\n            const currentScript = scripts[scripts.length - 1];\r\n            const src = currentScript?.src || '';\r\n            if (src) {\r\n              return src.substring(0, src.lastIndexOf('/') + 1);\r\n            }\r\n            // ÈôçÁ∫ßÊñπÊ°à\r\n            return '/hacsfiles/reachy-mini-3d-card/';\r\n          };\r\n\r\n          const basePath = getCardBasePath();\r\n          console.log('Card base path:', basePath);\r\n\r\n          // Âä®ÊÄÅÂØºÂÖ• urdf-loader\r\n          const URDFLoader = (await import(basePath + 'lib/urdf-loader.js')).default;\r\n\r\n          const urdfPath = basePath + 'assets/reachy-mini.urdf';\r\n\r\n          const loader = new URDFLoader();\r\n          loader.workingPath = basePath + 'assets/';\r\n          loader.pathPrefix = (path) => basePath + 'assets/' + path;\r\n\r\n          this.robot = await loader.load(urdfPath);\r\n          this.scene.add(this.robot);\r\n          this.robot.position.set(0, 0, 0);\r\n          this.joints = this.robot.joints;\r\n\r\n          console.log('Robot model loaded successfully');\r\n        } catch (error) {\r\n          console.error('Failed to load URDF model:', error);\r\n          this._connectionStatus = 'error';\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      /**\r\n       * ËøûÊé• Reachy Mini Daemon WebSocket\r\n       * ÂèÇËÄÉ reachy-mini-desktop-app ÁöÑÂÆûÁé∞\r\n       */\r\n      connectWebSocket() {\r\n        const host = this.config.daemon_host || 'localhost';\r\n        const port = this.config.daemon_port || 3333;\r\n\r\n        // Ê£ÄÊü•ÊòØÂê¶Â∑≤Ë∂ÖËøáÊúÄÂ§ßÈáçËøûÊ¨°Êï∞\r\n        if (this.reconnectAttempts >= this.maxReconnectAttempts) {\r\n          console.warn(`Max reconnection attempts (${this.maxReconnectAttempts}) reached. Please check if the daemon is running.`);\r\n          this._connectionStatus = 'error';\r\n          return;\r\n        }\r\n\r\n        try {\r\n          // WebSocket URL: ws://localhost:3333/api/state/ws/full\r\n          // ÂèÇÊï∞: frequency=20, with_head_pose=true, with_head_joints=true, with_antenna_positions=true, with_passive_joints=true\r\n          const wsUrl = `ws://${host}:${port}/api/state/ws/full?frequency=20&with_head_pose=true&use_pose_matrix=true&with_head_joints=true&with_antenna_positions=true&with_passive_joints=true`;\r\n\r\n          console.log(`Connecting to Reachy Mini daemon: ${wsUrl}`);\r\n          this._connectionStatus = 'connecting';\r\n\r\n          this.ws = new WebSocket(wsUrl);\r\n\r\n          this.ws.onopen = () => {\r\n            console.log('WebSocket connected to Reachy Mini daemon');\r\n            this._connectionStatus = 'connected';\r\n            this.reconnectAttempts = 0; // ÈáçÁΩÆÈáçËøûËÆ°Êï∞Âô®\r\n          };\r\n\r\n          this.ws.onmessage = (event) => {\r\n            try {\r\n              const data = JSON.parse(event.data);\r\n              this.updateRobotFromWebSocket(data);\r\n            } catch (err) {\r\n              console.error('Failed to parse WebSocket message:', err);\r\n            }\r\n          };\r\n\r\n          this.ws.onerror = (error) => {\r\n            console.error('WebSocket error:', error);\r\n            this._connectionStatus = 'error';\r\n          };\r\n\r\n          this.ws.onclose = () => {\r\n            console.log('WebSocket connection closed');\r\n            this._connectionStatus = 'disconnected';\r\n\r\n            // Â∞ùËØïÈáçËøû\r\n            if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n              this.reconnectAttempts++;\r\n              const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 10000); // ÊåáÊï∞ÈÄÄÈÅø,ÊúÄÂ§ß10Áßí\r\n              console.log(`Reconnecting in ${delay}ms... (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\r\n              setTimeout(() => this.connectWebSocket(), delay);\r\n            } else {\r\n              console.warn('Max reconnection attempts reached');\r\n              this._connectionStatus = 'error';\r\n            }\r\n          };\r\n        } catch (error) {\r\n          console.error('Failed to create WebSocket connection:', error);\r\n          this._connectionStatus = 'error';\r\n        }\r\n      }\r\n\r\n      /**\r\n       * ‰ªé WebSocket Êï∞ÊçÆÊõ¥Êñ∞Êú∫Âô®‰∫∫Áä∂ÊÄÅ\r\n       * ÂèÇËÄÉ reachy-mini-desktop-app ÁöÑÊï∞ÊçÆËß£ÊûêÈÄªËæë\r\n       */\r\n      updateRobotFromWebSocket(data) {\r\n        if (!this.robot || !this.robot.joints) return;\r\n\r\n        try {\r\n          // ÊèêÂèñ head_joints (7‰∏™ÂÄº: yaw_body + stewart_1-6)\r\n          if (data.head_joints && Array.isArray(data.head_joints) && data.head_joints.length === 7) {\r\n            const headJoints = data.head_joints;\r\n\r\n            // Êõ¥Êñ∞ Stewart platform ÂÖ≥ËäÇ\r\n            this.robot.setJointValue('yaw_body', headJoints[0] || 0);\r\n            this.robot.setJointValue('stewart_1', headJoints[1] || 0);\r\n            this.robot.setJointValue('stewart_2', headJoints[2] || 0);\r\n            this.robot.setJointValue('stewart_3', headJoints[3] || 0);\r\n            this.robot.setJointValue('stewart_4', headJoints[4] || 0);\r\n            this.robot.setJointValue('stewart_5', headJoints[5] || 0);\r\n            this.robot.setJointValue('stewart_6', headJoints[6] || 0);\r\n\r\n            this._robotData.headJoints = headJoints;\r\n          }\r\n\r\n          // ÊèêÂèñÂ§©Á∫ø‰ΩçÁΩÆ\r\n          if (data.antennas_position && Array.isArray(data.antennas_position) && data.antennas_position.length === 2) {\r\n            const [leftAntenna, rightAntenna] = data.antennas_position;\r\n\r\n            // Â§©Á∫øÊò†Â∞Ñ (ËßíÂ∫¶ÂèØËÉΩÈúÄË¶ÅÂèçËΩ¨,ÂèÇËÄÉ desktop app)\r\n            this.robot.setJointValue('left_antenna', -leftAntenna);\r\n            this.robot.setJointValue('right_antenna', -rightAntenna);\r\n\r\n            this._robotData.antennas = data.antennas_position;\r\n          }\r\n\r\n          // Â≠òÂÇ® head_pose (4x4Áü©Èòµ)\r\n          if (data.head_pose) {\r\n            const headPoseArray = Array.isArray(data.head_pose)\r\n              ? data.head_pose\r\n              : data.head_pose.m;\r\n\r\n            if (headPoseArray && headPoseArray.length === 16) {\r\n              this._robotData.headPose = headPoseArray;\r\n            }\r\n          }\r\n\r\n          // Â≠òÂÇ® passive_joints (21‰∏™ÂÄº)\r\n          if (data.passive_joints && Array.isArray(data.passive_joints) && data.passive_joints.length >= 21) {\r\n            this._robotData.passiveJoints = data.passive_joints;\r\n          }\r\n\r\n          this._connectionStatus = 'connected';\r\n        } catch (error) {\r\n          console.error('Error updating robot state:', error);\r\n          this._connectionStatus = 'error';\r\n        }\r\n      }\r\n\r\n      animate() {\r\n        if (!this.renderer) return;\r\n\r\n        requestAnimationFrame(this.animate.bind(this));\r\n\r\n        if (this.controls) {\r\n          this.controls.update();\r\n        }\r\n\r\n        if (this.config.auto_rotate && this.robot) {\r\n          this.robot.rotation.y += 0.005;\r\n        }\r\n\r\n        if (this.renderer && this.scene && this.camera) {\r\n          this.renderer.render(this.scene, this.camera);\r\n        }\r\n      }\r\n\r\n      onWindowResize() {\r\n        if (!this.camera || !this.renderer) return;\r\n\r\n        const container = this.shadowRoot.getElementById('canvas-container');\r\n        if (!container) return;\r\n\r\n        const width = container.clientWidth;\r\n        const height = this.config.height || 400;\r\n\r\n        this.camera.aspect = width / height;\r\n        this.camera.updateProjectionMatrix();\r\n        this.renderer.setSize(width, height);\r\n      }\r\n\r\n      cleanup() {\r\n        if (this.ws) {\r\n          this.ws.close();\r\n          this.ws = null;\r\n        }\r\n        window.removeEventListener('resize', this.onWindowResize.bind(this));\r\n        if (this.renderer) {\r\n          this.renderer.dispose();\r\n        }\r\n      }\r\n\r\n      // ÈÖçÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï\r\n      toggleEditMode() {\r\n        this._editing = !this._editing;\r\n      }\r\n\r\n      updateConfig(newConfig) {\r\n        this.config = { ...this.config, ...newConfig };\r\n        this.dispatchEvent(new CustomEvent('config-changed', {\r\n          detail: { config: this.config },\r\n          bubbles: true\r\n        }));\r\n\r\n        // Â¶ÇÊûúËøûÊé•ÈÖçÁΩÆÊîπÂèò,ÈáçÊñ∞ËøûÊé•\r\n        if (newConfig.daemon_host || newConfig.daemon_port) {\r\n          if (this.ws) {\r\n            this.ws.close();\r\n          }\r\n          this.reconnectAttempts = 0;\r\n          this.connectWebSocket();\r\n        }\r\n      }\r\n\r\n      render() {\r\n        return html`\r\n          <ha-card>\r\n            <div class=\"card-container\">\r\n              ${this._editing ? html`\r\n                <div class=\"config-panel open\">\r\n                  <div class=\"config-header\">\r\n                    <h3>‚öôÔ∏è Configuration</h3>\r\n                    <button class=\"close-btn\" @click=\"${() => this.toggleEditMode()}\">√ó</button>\r\n                  </div>\r\n\r\n                  <div class=\"config-item\">\r\n                    <label>Daemon Host</label>\r\n                    <input type=\"text\"\r\n                           .value=\"${this.config?.daemon_host || 'localhost'}\"\r\n                           @change=\"${(e) => this.updateConfig({ daemon_host: e.target.value })}\">\r\n                  </div>\r\n\r\n                  <div class=\"config-item\">\r\n                    <label>Daemon Port</label>\r\n                    <input type=\"number\"\r\n                           .value=\"${this.config?.daemon_port || 3333}\"\r\n                           @change=\"${(e) => this.updateConfig({ daemon_port: parseInt(e.target.value) })}\">\r\n                  </div>\r\n\r\n                  <div class=\"config-item\">\r\n                    <label>Height (${this.config?.height || 400}px)</label>\r\n                    <input type=\"range\"\r\n                           min=\"200\"\r\n                           max=\"800\"\r\n                           step=\"50\"\r\n                           .value=\"${this.config?.height || 400}\"\r\n                           @input=\"${(e) => this.updateConfig({ height: parseInt(e.target.value) })}\">\r\n                  </div>\r\n\r\n                  <div class=\"config-item\">\r\n                    <label>\r\n                      <input type=\"checkbox\"\r\n                             ?checked=\"${this.config?.auto_rotate || false}\"\r\n                             @change=\"${(e) => this.updateConfig({ auto_rotate: e.target.checked })}\">\r\n                      Auto Rotate\r\n                    </label>\r\n                  </div>\r\n\r\n                  <div class=\"config-item\">\r\n                    <p style=\"font-size:11px;color:#666;margin:8px 0;\">\r\n                      ‚ÑπÔ∏è Make sure Reachy Mini daemon is running on the specified host and port.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              ` : ''}\r\n\r\n              <div id=\"canvas-container\" style=\"height:${this.config?.height || 400}px\">\r\n                ${!this._loaded ? html`\r\n                  <div class=\"loading-overlay\">\r\n                    <div style=\"text-align:center\">\r\n                      <div style=\"font-size:24px;margin-bottom:8px\">ü§ñ</div>\r\n                      <div>Loading 3D model...</div>\r\n                    </div>\r\n                  </div>\r\n                ` : ''}\r\n\r\n                ${this._loaded && this._connectionStatus === 'error' ? html`\r\n                  <div class=\"error-message\">\r\n                    <div style=\"font-size:48px;\">‚ö†Ô∏è</div>\r\n                    <div style=\"font-size:16px;margin-top:10px;\">\r\n                      <strong>Connection Failed</strong><br>\r\n                      <small style=\"color:#666;\">Cannot connect to Reachy Mini daemon</small><br>\r\n                      <small style=\"color:#999;font-size:11px;\">\r\n                        Host: ${this.config.daemon_host}:${this.config.daemon_port}<br>\r\n                        Please check if the daemon is running\r\n                      </small>\r\n                    </div>\r\n                  </div>\r\n                ` : ''}\r\n              </div>\r\n\r\n              <!-- Áä∂ÊÄÅÊåáÁ§∫Âô® -->\r\n              ${this._loaded ? html`\r\n                <div class=\"status-overlay\">\r\n                  <span class=\"status-indicator ${this._connectionStatus === 'connecting' ? 'connecting' : this._connectionStatus === 'error' ? 'error' : ''}\"></span>\r\n                  <span>\r\n                    ${this._connectionStatus === 'connected' ? 'üü¢ Connected' : ''}\r\n                    ${this._connectionStatus === 'connecting' ? 'üü° Connecting...' : ''}\r\n                    ${this._connectionStatus === 'disconnected' ? 'üî¥ Disconnected' : ''}\r\n                    ${this._connectionStatus === 'error' ? '‚ùå Connection Error' : ''}\r\n                  </span>\r\n                </div>\r\n              ` : ''}\r\n\r\n              ${this.config?.show_controls !== false ? html`\r\n                <div class=\"controls\">\r\n                  <button class=\"control-btn\" @click=\"${() => this.resetCamera()}\" title=\"Reset View\">üéØ</button>\r\n                  <button class=\"control-btn\" @click=\"${() => this.toggleAutoRotate()}\" title=\"Toggle Rotation\">üîÑ</button>\r\n                </div>\r\n              ` : ''}\r\n\r\n              <div class=\"edit-mode\">\r\n                <button class=\"edit-btn\" @click=\"${() => this.toggleEditMode()}\" title=\"Edit Configuration\">‚öôÔ∏è</button>\r\n              </div>\r\n            </div>\r\n          </ha-card>\r\n        `;\r\n      }\r\n\r\n      resetCamera() {\r\n        if (this.camera && this.controls) {\r\n          this.camera.position.set(0.3, 0.3, 0.5);\r\n          this.controls.reset();\r\n        }\r\n      }\r\n\r\n      toggleAutoRotate() {\r\n        this.updateConfig({ auto_rotate: !this.config.auto_rotate });\r\n      }\r\n    }\r\n\r\n    // Ê≥®ÂÜåËá™ÂÆö‰πâÂç°Áâá\r\n    customElements.define('reachy-mini-3d-card', ReachyMini3DCard);\r\n\r\n    console.log('Reachy Mini 3D Card (Direct Connection) registered successfully');\r\n  } catch (error) {\r\n    console.error('Error initializing Reachy Mini 3D Card:', error);\r\n  }\r\n})();\r\n"],"names":["window","customCards","push","type","name","description","preview","documentationURL","loadScript","url","Promise","resolve","reject","script","document","createElement","src","onload","onerror","head","appendChild","LitElement","html","css","THREE","LitElementElement","strings","values","join","ReachyMini3DCard","properties","hass","Object","config","_editing","Boolean","state","_loaded","_connectionStatus","String","_robotData","styles","getStubConfig","daemon_host","daemon_port","height","show_controls","auto_rotate","setConfig","entity_prefix","console","warn","this","getCardSize","Math","ceil","constructor","super","headJoints","headPose","antennas","passiveJoints","ws","reconnectAttempts","maxReconnectAttempts","connectedCallback","requestAnimationFrame","initThreeJS","catch","err","error","disconnectedCallback","cleanup","container","shadowRoot","getElementById","setTimeout","scene","Scene","background","Color","width","clientWidth","camera","PerspectiveCamera","position","set","renderer","WebGLRenderer","antialias","alpha","setSize","setPixelRatio","min","devicePixelRatio","shadowMap","enabled","PCFSoftShadowMap","domElement","controls","OrbitControls","enableDamping","dampingFactor","minDistance","maxDistance","ambientLight","AmbientLight","add","directionalLight","DirectionalLight","castShadow","gridHelper","GridHelper","loadRobotModel","connectWebSocket","animate","addEventListener","onWindowResize","bind","basePath","scripts","getElementsByTagName","currentScript","length","substring","lastIndexOf","getCardBasePath","log","URDFLoader","import","default","urdfPath","loader","workingPath","pathPrefix","path","robot","load","joints","host","port","wsUrl","WebSocket","onopen","onmessage","event","data","JSON","parse","updateRobotFromWebSocket","onclose","delay","pow","head_joints","Array","isArray","setJointValue","antennas_position","leftAntenna","rightAntenna","head_pose","headPoseArray","m","passive_joints","update","rotation","y","render","aspect","updateProjectionMatrix","close","removeEventListener","dispose","toggleEditMode","updateConfig","newConfig","dispatchEvent","CustomEvent","detail","bubbles","e","target","value","parseInt","checked","resetCamera","toggleAutoRotate","reset","customElements","define"],"mappings":"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"}