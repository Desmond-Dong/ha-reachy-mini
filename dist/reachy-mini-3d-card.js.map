{"version":3,"file":"reachy-mini-3d-card.js","sources":["../src/reachy-mini-3d-card.js"],"sourcesContent":["// Reachy Mini 3D Card for Home Assistant\n// Â∏¶ÊúâÂèØËßÜÂåñÈÖçÁΩÆÁºñËæëÂô®ÁöÑÂÆåÊï¥ÁâàÊú¨\n// ÊîØÊåÅ HACS ÂÆâË£Ö\n\n// Á´ãÂç≥Ê≥®ÂÜå customCardsÔºàÂú®ÂºÇÊ≠•Âä†ËΩΩ‰πãÂâçÔºâ\nwindow.customCards = window.customCards || [];\nwindow.customCards.push({\n  type: 'reachy-mini-3d-card',\n  name: 'Reachy Mini 3D Card',\n  description: 'Real-time 3D visualization of Reachy Mini robot with visual configuration editor',\n  preview: true,\n  documentationURL: 'https://github.com/Desmond-Dong/ha-reachy-mini-card'\n});\n\n// Á°Æ‰øù THREE ÂÖ®Â±ÄÂØπË±°ÂèØÁî®\nif (!window.THREE) {\n  console.error('THREE.js not loaded yet');\n}\n\n(async () => {\n  try {\n    // ‰ªéÂΩìÂâçËÑöÊú¨‰ΩçÁΩÆÁ°ÆÂÆöÂü∫Á°ÄË∑ØÂæÑ\n    const getCurrentScriptBase = () => {\n      const scripts = document.getElementsByTagName('script');\n      const currentScript = scripts[scripts.length - 1];\n      const src = currentScript?.src || '';\n      if (src) {\n        return src.substring(0, src.lastIndexOf('/') + 1);\n      }\n      // ÈôçÁ∫ßÊñπÊ°àÔºöÂÅáËÆæÂú® HACS ÁõÆÂΩï\n      return '/hacsfiles/reachy-mini-3d-card/';\n    };\n\n    const BASE_URL = getCurrentScriptBase();\n    console.log('Card base URL:', BASE_URL);\n\n    // ‰ªé CDN ÊàñÊú¨Âú∞Âä†ËΩΩ Three.js\n    if (!window.THREE) {\n      await loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js');\n    }\n    await loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js');\n    await loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/STLLoader.js');\n\n    // LitElement Âíå Home Assistant Â∏ÆÂä©ÂáΩÊï∞\n    const { LitElement, html, css } = await loadLit();\n\n    class ReachyMini3DCard extends LitElement {\n      static get properties() {\n        return {\n          hass: Object,\n          config: Object,\n          _editing: { type: Boolean, state: true },\n          _loaded: { type: Boolean, state: true }\n        };\n      }\n\n    static get styles() {\n      return css`\n        :host {\n          display: block;\n          width: 100%;\n          position: relative;\n        }\n        ha-card {\n          overflow: hidden;\n          border-radius: var(--ha-card-border-radius, 12px);\n          box-shadow: var(--ha-card-box-shadow, none);\n        }\n        .card-container {\n          width: 100%;\n          position: relative;\n        }\n        #canvas-container {\n          width: 100%;\n          height: 400px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          position: relative;\n        }\n        .status-overlay {\n          position: absolute;\n          top: 10px;\n          left: 10px;\n          background: rgba(0,0,0,0.6);\n          color: white;\n          padding: 8px 12px;\n          border-radius: 8px;\n          font-family: var(--font-family, Roboto);\n          font-size: 12px;\n          pointer-events: none;\n        }\n        .controls {\n          position: absolute;\n          bottom: 10px;\n          right: 10px;\n          display: flex;\n          gap: 8px;\n        }\n        .control-btn {\n          background: rgba(255,255,255,0.9);\n          border: none;\n          border-radius: 8px;\n          padding: 8px 12px;\n          cursor: pointer;\n          font-size: 20px;\n          transition: all 0.2s;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n        }\n        .control-btn:hover {\n          background: white;\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n        .control-btn:active {\n          transform: translateY(0);\n        }\n        .edit-mode {\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          z-index: 100;\n        }\n        .edit-btn {\n          background: var(--primary-color, #03a9f4);\n          color: white;\n          border: none;\n          border-radius: 50%;\n          width: 40px;\n          height: 40px;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n          transition: all 0.2s;\n        }\n        .edit-btn:hover {\n          background: var(--primary-color, #0288d1);\n          transform: scale(1.1);\n        }\n        .config-panel {\n          position: absolute;\n          top: 0;\n          right: 0;\n          width: 320px;\n          height: 100%;\n          background: white;\n          box-shadow: -4px 0 16px rgba(0,0,0,0.1);\n          border-radius: 12px 0 0 12px;\n          padding: 20px;\n          overflow-y: auto;\n          z-index: 1000;\n          transform: translateX(100%);\n          transition: transform 0.3s ease;\n        }\n        .config-panel.open {\n          transform: translateX(0);\n        }\n        .config-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 20px;\n          padding-bottom: 10px;\n          border-bottom: 2px solid #f0f0f0;\n        }\n        .config-header h3 {\n          margin: 0;\n          color: #333;\n          font-size: 18px;\n        }\n        .close-btn {\n          background: none;\n          border: none;\n          font-size: 24px;\n          cursor: pointer;\n          color: #666;\n          padding: 0;\n          width: 30px;\n          height: 30px;\n        }\n        .close-btn:hover {\n          color: #333;\n        }\n        .config-item {\n          margin-bottom: 16px;\n        }\n        .config-item label {\n          display: block;\n          margin-bottom: 6px;\n          font-size: 13px;\n          color: #555;\n          font-weight: 500;\n        }\n        .config-item input[type=\"text\"],\n        .config-item input[type=\"number\"],\n        .config-item select {\n          width: 100%;\n          padding: 8px 12px;\n          border: 1px solid #ddd;\n          border-radius: 6px;\n          font-size: 14px;\n          box-sizing: border-box;\n          transition: border-color 0.2s;\n        }\n        .config-item input:focus,\n        .config-item select:focus {\n          outline: none;\n          border-color: var(--primary-color, #03a9f4);\n          box-shadow: 0 0 0 3px rgba(3, 169, 244, 0.1);\n        }\n        .config-item ha-switch {\n          display: block;\n        }\n        .entity-selector {\n          position: relative;\n        }\n        .entity-selector input {\n          padding-right: 30px;\n        }\n        .entity-icon {\n          position: absolute;\n          right: 8px;\n          top: 50%;\n          transform: translateY(-50%);\n          color: #999;\n        }\n        .preset-buttons {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n          margin-bottom: 16px;\n        }\n        .preset-btn {\n          background: #f5f5f5;\n          border: 1px solid #ddd;\n          border-radius: 6px;\n          padding: 8px 12px;\n          cursor: pointer;\n          font-size: 12px;\n          transition: all 0.2s;\n        }\n        .preset-btn:hover {\n          background: var(--primary-color, #03a9f4);\n          color: white;\n          border-color: var(--primary-color, #03a9f4);\n        }\n        .loading-overlay {\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(255,255,255,0.9);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 16px;\n          color: #666;\n          z-index: 50;\n        }\n      `;\n    }\n\n    static getStubConfig() {\n      return {\n        entity_prefix: 'reachy_mini',\n        height: 400,\n        show_controls: true,\n        auto_rotate: false,\n        xray_mode: false,\n        wireframe: false\n      };\n    }\n\n    setConfig(config) {\n      if (!config.entity_prefix) {\n        throw new Error('You need to define an entity prefix');\n      }\n      this.config = {\n        ...ReachyMini3DCard.getStubConfig(),\n        ...config\n      };\n    }\n\n    getCardSize() {\n      return Math.ceil(this.config.height / 50);\n    }\n\n    constructor() {\n      super();\n      this._loaded = false;\n      this._editing = false;\n    }\n\n    connectedCallback() {\n      super.connectedCallback();\n      // Âª∂ËøüÂàùÂßãÂåñ,Á°Æ‰øù DOM Â∑≤ÂáÜÂ§áÂ•Ω\n      requestAnimationFrame(() => {\n        this.initThreeJS().catch(err => {\n          console.error('Failed to initialize Three.js:', err);\n          this._loaded = true;\n        });\n      });\n    }\n\n    disconnectedCallback() {\n      super.disconnectedCallback();\n      this.cleanup();\n    }\n\n    async initThreeJS() {\n      const container = this.shadowRoot?.getElementById('canvas-container');\n      if (!container) {\n        console.warn('Canvas container not found, retrying...');\n        // Â¶ÇÊûúÂÆπÂô®ËøòÊ≤°ÂáÜÂ§áÂ•Ω,Á®çÂêéÈáçËØï\n        await new Promise(resolve => setTimeout(resolve, 100));\n        return this.initThreeJS();\n      }\n\n      try {\n        // Âú∫ÊôØ\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color(0xf0f0f0);\n\n        // Áõ∏Êú∫\n        const width = container.clientWidth;\n        const height = this.config?.height || 400;\n        this.camera = new THREE.PerspectiveCamera(50, width / height, 0.01, 1000);\n        this.camera.position.set(0.3, 0.3, 0.5);\n\n        // Ê∏≤ÊüìÂô®\n        this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\n        this.renderer.setSize(width, height);\n        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n        this.renderer.shadowMap.enabled = true;\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n        container.appendChild(this.renderer.domElement);\n\n        // ÊéßÂà∂Âô®\n        this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);\n        this.controls.enableDamping = true;\n        this.controls.dampingFactor = 0.05;\n        this.controls.minDistance = 0.2;\n        this.controls.maxDistance = 1;\n\n        // ÁÅØÂÖâ\n        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);\n        this.scene.add(ambientLight);\n\n        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\n        directionalLight.position.set(1, 1, 1);\n        directionalLight.castShadow = true;\n        this.scene.add(directionalLight);\n\n        // Âú∞Èù¢ÁΩëÊ†º\n        const gridHelper = new THREE.GridHelper(0.4, 20, 0x888888, 0xcccccc);\n        this.scene.add(gridHelper);\n\n        // Âä†ËΩΩÊú∫Âô®‰∫∫Ê®°Âûã\n        await this.loadRobotModel();\n\n        // Ê†áËÆ∞‰∏∫Â∑≤Âä†ËΩΩ\n        this._loaded = true;\n\n        // ÂºÄÂßãÂä®ÁîªÂæ™ÁéØ\n        this.animate();\n\n        // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ\n        window.addEventListener('resize', this.onWindowResize.bind(this));\n\n        // ÂêØÂä®Áä∂ÊÄÅÊõ¥Êñ∞\n        this.startStateUpdate();\n      } catch (error) {\n        console.error('Error initializing Three.js:', error);\n        this._loaded = true;\n        throw error;\n      }\n    }\n\n    async loadRobotModel() {\n      try {\n        // Âä®ÊÄÅÂØºÂÖ• urdf-loader\n        const URDFLoader = (await import('/hacsfiles/reachy-mini-3d-card/lib/urdf-loader.js')).default;\n\n        // HACS ÂÆâË£ÖÂêéÁöÑË∑ØÂæÑÁªìÊûÑÔºö\n        // /hacsfiles/reachy-mini-3d-card/reachy-mini-3d-card.js (ÂΩìÂâçÊñá‰ª∂)\n        // /hacsfiles/reachy-mini-3d-card/assets/reachy-mini.urdf\n        // /hacsfiles/reachy-mini-3d-card/assets/meshes/xxx.stl\n\n        // ÊûÑÈÄ† URDF Êñá‰ª∂Ë∑ØÂæÑ\n        const urdfPath = '/hacsfiles/reachy-mini-3d-card/assets/reachy-mini.urdf';\n\n        // ÂàõÂª∫ URDFLoader\n        const loader = new URDFLoader();\n\n        // ËÆæÁΩÆÂ∑•‰ΩúÁõÆÂΩïË∑ØÂæÑ (Áî®‰∫éËß£ÊûêÁõ∏ÂØπË∑ØÂæÑ)\n        loader.workingPath = '/hacsfiles/reachy-mini-3d-card/assets/';\n\n        // ËÆæÁΩÆËµÑÊ∫êË∑ØÂæÑÂâçÁºÄ\n        loader.pathPrefix = (path) => {\n          // URDF ‰∏≠ÁöÑË∑ØÂæÑÊòØ \"meshes/xxx.stl\"\n          // ËΩ¨Êç¢‰∏∫ÂÆåÊï¥Ë∑ØÂæÑ\n          return '/hacsfiles/reachy-mini-3d-card/assets/' + path;\n        };\n\n        // Âä†ËΩΩ URDF\n        this.robot = await loader.load(urdfPath);\n\n        // Â∞ÜÊú∫Âô®‰∫∫Ê∑ªÂä†Âà∞Âú∫ÊôØ\n        this.scene.add(this.robot);\n\n        // ËÆæÁΩÆÊú∫Âô®‰∫∫ÂàùÂßã‰ΩçÁΩÆ\n        this.robot.position.set(0, 0, 0);\n\n        // Â≠òÂÇ®ÂÖ≥ËäÇÂºïÁî®‰ª•‰æøÂêéÁª≠Êõ¥Êñ∞\n        this.joints = this.robot.joints;\n\n        console.log('Robot model loaded successfully:', this.robot);\n        console.log('Available joints:', Object.keys(this.robot.joints));\n\n      } catch (error) {\n        console.error('Failed to load URDF model:', error);\n\n        // ÈôçÁ∫ßÊñπÊ°àÔºöÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ\n        const errorDiv = document.createElement('div');\n        errorDiv.style.cssText = `\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          text-align: center;\n          color: #f44336;\n          padding: 20px;\n          background: white;\n          border-radius: 8px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        `;\n        errorDiv.innerHTML = `\n          <div style=\"font-size: 48px;\">‚ö†Ô∏è</div>\n          <div style=\"font-size: 16px; margin-top: 10px;\">\n            <strong>Ê®°ÂûãÂä†ËΩΩÂ§±Ë¥•</strong><br>\n            <small style=\"color: #666;\">${error.message}</small><br>\n            <small style=\"color: #999; font-size: 11px;\">ËØ∑Á°Æ‰øùÊñá‰ª∂Â∑≤Ê≠£Á°ÆÂÆâË£ÖÂà∞ HACS</small>\n          </div>\n        `;\n        this.shadowRoot.getElementById('canvas-container').appendChild(errorDiv);\n      }\n    }\n\n    startStateUpdate() {\n      // ÊØè 50ms Êõ¥Êñ∞‰∏ÄÊ¨° (20Hz)\n      this.updateInterval = setInterval(() => {\n        if (this.hass && this.robot) {\n          this.updateRobotState();\n        }\n      }, 50);\n    }\n\n    updateRobotState() {\n      if (!this.robot || !this.robot.joints) return;\n\n      const prefix = this.config.entity_prefix;\n\n      // ‰ªé Home Assistant ÂÆû‰ΩìËé∑ÂèñÁä∂ÊÄÅ\n      const getState = (entityType, entityName) => {\n        const entityId = `${entityType}.${prefix}_${entityName}`;\n        const state = this.hass.states[entityId];\n        return state ? parseFloat(state.state) : 0;\n      };\n\n      // Ëé∑ÂèñÂÖ≥ËäÇÊï∞ÊçÆ (‰ªé JSON sensor)\n      const headJointsState = this.hass.states[`sensor.${prefix}_head_joints`];\n      const headPoseState = this.hass.states[`sensor.${prefix}_head_pose`];\n\n      if (headJointsState && headJointsState.state !== 'unknown') {\n        try {\n          const headJoints = JSON.parse(headJointsState.state);\n\n          // Stewart platform ÂÖ≥ËäÇ (ÂèÇËÄÉ desktop app ÁöÑÊò†Â∞Ñ)\n          this.robot.setJointValue('yaw_body', headJoints[0] || 0);\n          this.robot.setJointValue('stewart_1', headJoints[1] || 0);\n          this.robot.setJointValue('stewart_2', headJoints[2] || 0);\n          this.robot.setJointValue('stewart_3', headJoints[3] || 0);\n          this.robot.setJointValue('stewart_4', headJoints[4] || 0);\n          this.robot.setJointValue('stewart_5', headJoints[5] || 0);\n          this.robot.setJointValue('stewart_6', headJoints[6] || 0);\n\n        } catch (e) {\n          console.warn('Failed to parse head_joints:', e);\n        }\n      }\n\n      // Ëé∑ÂèñÂ§©Á∫øËßíÂ∫¶\n      const antennaLeft = getState('number', 'antenna_left');\n      const antennaRight = getState('number', 'antenna_right');\n\n      // Â§©Á∫øÊò†Â∞Ñ (Ê≥®ÊÑèÔºöËßíÂ∫¶ÂèØËÉΩÈúÄË¶ÅÂèçËΩ¨ÔºåÂèÇËÄÉ desktop app)\n      this.robot.setJointValue('left_antenna', -antennaLeft);\n      this.robot.setJointValue('right_antenna', -antennaRight);\n    }\n\n    animate() {\n      if (!this.renderer) return;\n\n      requestAnimationFrame(this.animate.bind(this));\n\n      if (this.controls) {\n        this.controls.update();\n      }\n\n      if (this.config.auto_rotate && this.robot) {\n        this.robot.rotation.y += 0.005;\n      }\n\n      if (this.renderer && this.scene && this.camera) {\n        this.renderer.render(this.scene, this.camera);\n      }\n    }\n\n    onWindowResize() {\n      if (!this.camera || !this.renderer) return;\n\n      const container = this.shadowRoot.getElementById('canvas-container');\n      if (!container) return;\n\n      const width = container.clientWidth;\n      const height = this.config.height || 400;\n\n      this.camera.aspect = width / height;\n      this.camera.updateProjectionMatrix();\n      this.renderer.setSize(width, height);\n    }\n\n    cleanup() {\n      if (this.updateInterval) {\n        clearInterval(this.updateInterval);\n      }\n      window.removeEventListener('resize', this.onWindowResize.bind(this));\n      if (this.renderer) {\n        this.renderer.dispose();\n      }\n    }\n\n    showError(message) {\n      const container = this.shadowRoot.getElementById('canvas-container');\n      if (container) {\n        container.innerHTML = `<div style=\"display:flex;align-items:center;justify-content:center;height:100%;color:#f44336;font-size:14px;\">${message}</div>`;\n      }\n    }\n\n    // ÈÖçÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï\n    toggleEditMode() {\n      this._editing = !this._editing;\n    }\n\n    updateConfig(newConfig) {\n      this.config = { ...this.config, ...newConfig };\n      this.dispatchEvent(new CustomEvent('config-changed', {\n        detail: { config: this.config },\n        bubbles: true\n      }));\n    }\n\n    render() {\n      return html`\n        <ha-card>\n          <div class=\"card-container\">\n            ${this._editing ? html`\n              <div class=\"config-panel open\">\n                <div class=\"config-header\">\n                  <h3>‚öôÔ∏è Card Configuration</h3>\n                  <button class=\"close-btn\" @click=\"${() => this.toggleEditMode()}\">√ó</button>\n                </div>\n\n                <div class=\"preset-buttons\">\n                  <button class=\"preset-btn\" @click=\"${() => this.applyPreset('default')}\">üè† Default</button>\n                  <button class=\"preset-btn\" @click=\"${() => this.applyPreset('compact')}\">üì± Compact</button>\n                  <button class=\"preset-btn\" @click=\"${() => this.applyPreset('detailed')}\">üìä Detailed</button>\n                  <button class=\"preset-btn\" @click=\"${() => this.applyPreset('minimal')}\">‚ú® Minimal</button>\n                </div>\n\n                <div class=\"config-item\">\n                  <label>Entity Prefix</label>\n                  <div class=\"entity-selector\">\n                    <input type=\"text\"\n                           .value=\"${this.config?.entity_prefix || ''}\"\n                           @change=\"${(e) => this.updateConfig({ entity_prefix: e.target.value })}\">\n                    <span class=\"entity-icon\">üîó</span>\n                  </div>\n                </div>\n\n                <div class=\"config-item\">\n                  <label>Height (${this.config?.height || 400}px)</label>\n                  <input type=\"range\"\n                         min=\"200\"\n                         max=\"800\"\n                         step=\"50\"\n                         .value=\"${this.config?.height || 400}\"\n                         @input=\"${(e) => this.updateConfig({ height: parseInt(e.target.value) })}\">\n                </div>\n\n                <div class=\"config-item\">\n                  <label>Options</label>\n                  <label style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                    <input type=\"checkbox\"\n                           ?checked=\"${this.config?.show_controls !== false}\"\n                           @change=\"${(e) => this.updateConfig({ show_controls: e.target.checked })}\">\n                    Show Controls\n                  </label>\n                  <label style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                    <input type=\"checkbox\"\n                           ?checked=\"${this.config?.auto_rotate || false}\"\n                           @change=\"${(e) => this.updateConfig({ auto_rotate: e.target.checked })}\">\n                    Auto Rotate\n                  </label>\n                  <label style=\"display:flex;align-items:center;gap:8px;\">\n                    <input type=\"checkbox\"\n                           ?checked=\"${this.config?.xray_mode || false}\"\n                           @change=\"${(e) => this.updateConfig({ xray_mode: e.target.checked })}\">\n                    X-Ray Mode\n                  </label>\n                </div>\n              </div>\n            ` : ''}\n\n            <div id=\"canvas-container\" style=\"height:${this.config?.height || 400}px\">\n              ${!this._loaded ? html`\n                <div class=\"loading-overlay\">\n                  <div style=\"text-align:center\">\n                    <div style=\"font-size:24px;margin-bottom:8px\">ü§ñ</div>\n                    <div>Loading 3D model...</div>\n                  </div>\n                </div>\n              ` : ''}\n            </div>\n\n            ${this.config?.show_controls !== false ? html`\n              <div class=\"controls\">\n                <button class=\"control-btn\" @click=\"${() => this.resetCamera()}\" title=\"Reset View\">üéØ</button>\n                <button class=\"control-btn\" @click=\"${() => this.toggleAutoRotate()}\" title=\"Toggle Rotation\">üîÑ</button>\n              </div>\n            ` : ''}\n\n            <div class=\"edit-mode\">\n              <button class=\"edit-btn\" @click=\"${() => this.toggleEditMode()}\" title=\"Edit Configuration\">‚öôÔ∏è</button>\n            </div>\n          </div>\n        </ha-card>\n      `;\n    }\n\n    resetCamera() {\n      if (this.camera && this.controls) {\n        this.camera.position.set(0.3, 0.3, 0.5);\n        this.controls.reset();\n      }\n    }\n\n    toggleAutoRotate() {\n      this.updateConfig({ auto_rotate: !this.config.auto_rotate });\n    }\n\n    applyPreset(preset) {\n      const presets = {\n        default: { height: 400, show_controls: true, auto_rotate: false },\n        compact: { height: 300, show_controls: false, auto_rotate: true },\n        detailed: { height: 600, show_controls: true, auto_rotate: false, xray_mode: true },\n        minimal: { height: 250, show_controls: false, auto_rotate: false }\n      };\n      this.updateConfig(presets[preset] || presets.default);\n    }\n  }\n\n  // Ê≥®ÂÜåËá™ÂÆö‰πâÂç°Áâá\n  customElements.define('reachy-mini-3d-card', ReachyMini3DCard);\n\n  console.log('Reachy Mini 3D Card registered successfully');\n\n  // ËæÖÂä©ÂáΩÊï∞\n  async function loadScript(url) {\n    return new Promise((resolve, reject) => {\n      const script = document.createElement('script');\n      script.src = url;\n      script.onload = resolve;\n      script.onerror = reject;\n      document.head.appendChild(script);\n    });\n  }\n\n  async function loadLit() {\n    if (window.LitElement) {\n      return { LitElement: window.LitElement, html: window.html, css: window.css };\n    }\n    await loadScript('https://cdn.jsdelivr.net/npm/lit@3.1.0/index.js');\n    await loadScript('https://cdn.jsdelivr.net/npm/lit@3.1.0/decorators.js');\n    await loadScript('https://cdn.jsdelivr.net/npm/lit@3.1.0/polyfill-support.js');\n\n    // Lit ÈúÄË¶Å polyfill\n    await loadScript('https://cdn.jsdelivr.net/npm/@lit/reactive-element@1.6.0/reactive-element.js');\n    await loadScript('https://cdn.jsdelivr.net/npm/lit@3.1.0/lit-element.js');\n\n    return {\n      LitElement: window.LitElement || window.LitElementElement,\n      html: window.html || ((strings, ...values) => ({ strings, values })),\n      css: window.css || ((strings, ...values) => strings.join(''))\n    };\n  }\n\n  } catch (error) {\n    console.error('Error initializing Reachy Mini 3D Card:', error);\n  }\n})();\n"],"names":["window","customCards","push","type","name","description","preview","documentationURL","THREE","console","error","BASE_URL","scripts","document","getElementsByTagName","currentScript","length","src","substring","lastIndexOf","getCurrentScriptBase","log","loadScript","LitElement","html","css","loadLit","ReachyMini3DCard","properties","hass","Object","config","_editing","Boolean","state","_loaded","styles","getStubConfig","entity_prefix","height","show_controls","auto_rotate","xray_mode","wireframe","setConfig","Error","this","getCardSize","Math","ceil","constructor","super","connectedCallback","requestAnimationFrame","initThreeJS","catch","err","disconnectedCallback","cleanup","container","shadowRoot","getElementById","warn","Promise","resolve","setTimeout","scene","Scene","background","Color","width","clientWidth","camera","PerspectiveCamera","position","set","renderer","WebGLRenderer","antialias","alpha","setSize","setPixelRatio","min","devicePixelRatio","shadowMap","enabled","PCFSoftShadowMap","appendChild","domElement","controls","OrbitControls","enableDamping","dampingFactor","minDistance","maxDistance","ambientLight","AmbientLight","add","directionalLight","DirectionalLight","castShadow","gridHelper","GridHelper","loadRobotModel","animate","addEventListener","onWindowResize","bind","startStateUpdate","URDFLoader","import","default","urdfPath","loader","workingPath","pathPrefix","path","robot","load","joints","keys","errorDiv","createElement","style","cssText","innerHTML","message","updateInterval","setInterval","updateRobotState","prefix","getState","entityType","entityName","entityId","states","parseFloat","headJointsState","headJoints","JSON","parse","setJointValue","e","antennaLeft","antennaRight","update","rotation","y","render","aspect","updateProjectionMatrix","clearInterval","removeEventListener","dispose","showError","toggleEditMode","updateConfig","newConfig","dispatchEvent","CustomEvent","detail","bubbles","applyPreset","target","value","parseInt","checked","resetCamera","toggleAutoRotate","reset","preset","presets","compact","detailed","minimal","async","url","reject","script","onload","onerror","head","LitElementElement","strings","values","join","customElements","define"],"mappings":"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"}